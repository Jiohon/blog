#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

# 版本更新
node scripts/bump-version.js
git add package.json

# 代码校验
echo "🔍 开始代码校验..."

# ESLint 检查
echo "📋 运行 ESLint 检查..."
pnpm lint:check
if [ $? -ne 0 ]; then
  echo "❌ ESLint 检查失败，请修复代码问题后再提交"
  exit 1
fi

# Prettier 格式检查
echo "💄 运行 Prettier 格式检查..."
pnpm format:check
if [ $? -ne 0 ]; then
  echo "❌ 代码格式检查失败，请运行 'pnpm format' 修复格式问题后再提交"
  exit 1
fi

# TypeScript 类型检查
echo "🔧 运行 TypeScript 类型检查..."
pnpm type-check
if [ $? -ne 0 ]; then
  echo "❌ TypeScript 类型检查失败，请修复类型错误后再提交"
  exit 1
fi

echo "✅ 所有代码校验通过！"